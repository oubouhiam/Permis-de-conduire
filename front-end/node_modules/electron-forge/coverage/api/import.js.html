<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for api/import.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">All files</a> / <a href="index.html">api</a> import.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">1.04% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>1/96</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/53</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/10</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">1.05% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>1/95</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import debug from 'debug';
import fs from 'fs-promise';
import inquirer from 'inquirer';
import path from 'path';
import { spawn as yarnOrNPMSpawn, hasYarn } from 'yarn-or-npm';
&nbsp;
import initGit from '../init/init-git';
import { deps, devDeps } from '../init/init-npm';
&nbsp;
import asyncOra from '../util/ora-handler';
import installDepList from '../util/install-dependencies';
import readPackageJSON from '../util/read-package-json';
import confirmIfInteractive from '../util/confirm-if-interactive';
&nbsp;
const d = debug('electron-forge:import');
&nbsp;
/**
 * @typedef {Object} ImportOptions
 * @property {string} [dir=process.cwd()] The path to the app to be imported
 * @property {boolean} [interactive=false] Whether to use sensible defaults or prompt the user visually
 */
&nbsp;
/**
 * Attempt to import a given module directory to the Electron Forge standard.
 *
 * - Replaces the prebuilt electron package with the one that integrates with `electron-compile`
 * - Sets up `git` and the correct NPM dependencies
 * - Adds a template forge config to `package.json`
 *
 * @param {ImportOptions} providedOptions - Options for the import method
 * @return {Promise} Will resolve when the import process is complete
 */
export default <span class="fstat-no" title="function not covered" >as</span>ync (providedOptions = <span class="branch-0 cbranch-no" title="branch not covered" >{})</span> =&gt; {
  const { dir, interactive } = <span class="cstat-no" title="statement not covered" >Object.assign({</span>
    dir: process.cwd(),
    interactive: false,
  }, providedOptions);
<span class="cstat-no" title="statement not covered" >  asyncOra.interactive = interactive;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  d(`Attempting to import project in: ${dir}`);</span>
<span class="cstat-no" title="statement not covered" >  if (!await fs.exists(dir) || !await fs.exists(path.resolve(dir, 'package.json'))) {</span>
<span class="cstat-no" title="statement not covered" >    console.error(`We couldn't find a project in: ${dir}`.red);</span>
<span class="cstat-no" title="statement not covered" >    process.exit(1);</span>
  }
&nbsp;
  // eslint-disable-next-line max-len
  const confirm = <span class="cstat-no" title="statement not covered" >await confirmIfInteractive(interactive, `WARNING: We will now attempt to import: "${dir}".  This will involve modifying some files, are you sure you want to continue?`);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  if (!confirm) {</span>
<span class="cstat-no" title="statement not covered" >    process.exit(1);</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  await initGit(dir);</span>
&nbsp;
  let packageJSON = <span class="cstat-no" title="statement not covered" >await readPackageJSON(dir);</span>
<span class="cstat-no" title="statement not covered" >  if (packageJSON.config &amp;&amp; packageJSON.config.forge) {</span>
<span class="cstat-no" title="statement not covered" >    console.warn('It looks like this project is already configured for "electron-forge"'.green);</span>
    const shouldContinue = <span class="cstat-no" title="statement not covered" >await confirmIfInteractive(interactive, 'Are you sure you want to continue?');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (!shouldContinue) {</span>
<span class="cstat-no" title="statement not covered" >      process.exit(0);</span>
    }
  }
&nbsp;
  // eslint-disable-next-line max-len
  const shouldChangeMain = <span class="cstat-no" title="statement not covered" >await confirmIfInteractive(interactive, 'Do you want us to change the "main" attribute of your package.json?  If you are currently using babel and pointing to a "build" directory say yes.', false);</span>
<span class="cstat-no" title="statement not covered" >  if (shouldChangeMain) {</span>
    const { newMain } = <span class="cstat-no" title="statement not covered" >await inquirer.createPromptModule()({</span>
      type: 'input',
      name: 'newMain',
      default: packageJSON.main,
      message: 'Enter the relative path to your uncompiled main file',
    });
<span class="cstat-no" title="statement not covered" >    packageJSON.main = newMain;</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  packageJSON.dependencies = packageJSON.dependencies || {};</span>
<span class="cstat-no" title="statement not covered" >  packageJSON.devDependencies = packageJSON.devDependencies || {};</span>
&nbsp;
  const keys = <span class="cstat-no" title="statement not covered" >Object.keys(packageJSON.dependencies).concat(Object.keys(packageJSON.devDependencies));</span>
  const buildToolPackages = <span class="cstat-no" title="statement not covered" >{</span>
    'electron-builder': 'provides mostly equivalent functionality',
    'electron-download': 'already uses this module as a transitive dependency',
    'electron-installer-debian': 'already uses this module as a transitive dependency',
    'electron-installer-dmg': 'already uses this module as a transitive dependency',
    'electron-installer-flatpak': 'already uses this module as a transitive dependency',
    'electron-installer-redhat': 'already uses this module as a transitive dependency',
    'electron-osx-sign': 'already uses this module as a transitive dependency',
    'electron-packager': 'already uses this module as a transitive dependency',
    'electron-winstaller': 'already uses this module as a transitive dependency',
  };
&nbsp;
  let electronName;
<span class="cstat-no" title="statement not covered" >  for (const key of keys) {</span>
<span class="cstat-no" title="statement not covered" >    if (key === 'electron' || key === 'electron-prebuilt') {</span>
<span class="cstat-no" title="statement not covered" >      delete packageJSON.dependencies[key];</span>
<span class="cstat-no" title="statement not covered" >      delete packageJSON.devDependencies[key];</span>
<span class="cstat-no" title="statement not covered" >      electronName = key;</span>
    } else <span class="cstat-no" title="statement not covered" >if (buildToolPackages[key]) {</span>
      const explanation = <span class="cstat-no" title="statement not covered" >buildToolPackages[key];</span>
      // eslint-disable-next-line max-len
      const shouldRemoveDependency = <span class="cstat-no" title="statement not covered" >await confirmIfInteractive(interactive, `Do you want us to remove the "${key}" dependency in package.json? Electron Forge ${explanation}.`);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      if (shouldRemoveDependency) {</span>
<span class="cstat-no" title="statement not covered" >        delete packageJSON.dependencies[key];</span>
<span class="cstat-no" title="statement not covered" >        delete packageJSON.devDependencies[key];</span>
      }
    }
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  packageJSON.scripts = packageJSON.scripts || {};</span>
<span class="cstat-no" title="statement not covered" >  d('reading current scripts object:', packageJSON.scripts);</span>
&nbsp;
  const updatePackageScript = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >as</span>ync (scriptName, newValue) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >    if (packageJSON.scripts[scriptName] !== newValue) {</span>
      // eslint-disable-next-line max-len
      const shouldUpdate = <span class="cstat-no" title="statement not covered" >await confirmIfInteractive(interactive, `Do you want us to update the "${scriptName}" script to instead call the electron-forge task "${newValue}"`);</span>
<span class="cstat-no" title="statement not covered" >      if (shouldUpdate) {</span>
<span class="cstat-no" title="statement not covered" >        packageJSON.scripts[scriptName] = newValue;</span>
      }
    }
  };
&nbsp;
<span class="cstat-no" title="statement not covered" >  await updatePackageScript('start', 'electron-forge start');</span>
<span class="cstat-no" title="statement not covered" >  await updatePackageScript('package', 'electron-forge package');</span>
<span class="cstat-no" title="statement not covered" >  await updatePackageScript('make', 'electron-forge make');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  d('forgified scripts object:', packageJSON.scripts);</span>
&nbsp;
  const writeChanges = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >as</span>ync () =&gt; {</span>
<span class="cstat-no" title="statement not covered" >    await asyncOra('Writing modified package.json file', <span class="fstat-no" title="function not covered" >as</span>ync () =&gt; {</span>
<span class="cstat-no" title="statement not covered" >      await fs.writeFile(path.resolve(dir, 'package.json'), `${JSON.stringify(packageJSON, null, 2)}\n`);</span>
    });
  };
&nbsp;
  let electronVersion;
<span class="cstat-no" title="statement not covered" >  if (electronName) {</span>
    const electronPackageJSON = <span class="cstat-no" title="statement not covered" >await readPackageJSON(path.resolve(dir, 'node_modules', electronName));</span>
<span class="cstat-no" title="statement not covered" >    electronVersion = electronPackageJSON.version;</span>
<span class="cstat-no" title="statement not covered" >    packageJSON.devDependencies['electron-prebuilt-compile'] = electronVersion;</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  await writeChanges();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  if (electronName) {</span>
<span class="cstat-no" title="statement not covered" >    await asyncOra('Pruning deleted modules', <span class="fstat-no" title="function not covered" >as</span>ync () =&gt; {</span>
<span class="cstat-no" title="statement not covered" >      await new Promise(<span class="fstat-no" title="function not covered" >(r</span>esolve) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >        d('attempting to prune node_modules in:', dir);</span>
        const child = <span class="cstat-no" title="statement not covered" >yarnOrNPMSpawn(hasYarn() ? [] : ['prune'], {</span>
          cwd: dir,
          stdio: 'ignore',
        });
<span class="cstat-no" title="statement not covered" >        child.on('exit', <span class="fstat-no" title="function not covered" >()</span> =&gt; <span class="cstat-no" title="statement not covered" >resolve())</span>;</span>
      });
    });
&nbsp;
<span class="cstat-no" title="statement not covered" >    await asyncOra('Installing dependencies', <span class="fstat-no" title="function not covered" >as</span>ync () =&gt; {</span>
<span class="cstat-no" title="statement not covered" >      d('deleting old dependencies forcefully');</span>
<span class="cstat-no" title="statement not covered" >      await fs.remove(path.resolve(dir, 'node_modules/.bin/electron'));</span>
<span class="cstat-no" title="statement not covered" >      await fs.remove(path.resolve(dir, 'node_modules/.bin/electron.cmd'));</span>
<span class="cstat-no" title="statement not covered" >      await fs.remove(path.resolve(dir, 'node_modules', electronName));</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      d('installing dependencies');</span>
<span class="cstat-no" title="statement not covered" >      await installDepList(dir, deps);</span>
<span class="cstat-no" title="statement not covered" >      d('installing devDependencies');</span>
<span class="cstat-no" title="statement not covered" >      await installDepList(dir, devDeps, true);</span>
<span class="cstat-no" title="statement not covered" >      d('installing electron-prebuilt-compile');</span>
<span class="cstat-no" title="statement not covered" >      await installDepList(dir, [`electron-prebuilt-compile@${electronVersion}`], false, true);</span>
    });
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  packageJSON = await readPackageJSON(dir);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  packageJSON.config = packageJSON.config || {};</span>
  const templatePackageJSON = <span class="cstat-no" title="statement not covered" >await readPackageJSON(path.resolve(__dirname, '../../tmpl'));</span>
<span class="cstat-no" title="statement not covered" >  packageJSON.config.forge = templatePackageJSON.config.forge;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  await writeChanges();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  await asyncOra('Fixing .gitignore', <span class="fstat-no" title="function not covered" >as</span>ync () =&gt; {</span>
<span class="cstat-no" title="statement not covered" >    if (await fs.exists(path.resolve(dir, '.gitignore'))) {</span>
      const gitignore = <span class="cstat-no" title="statement not covered" >await fs.readFile(path.resolve(dir, '.gitignore'));</span>
<span class="cstat-no" title="statement not covered" >      if (!gitignore.includes('out')) {</span>
<span class="cstat-no" title="statement not covered" >        await fs.writeFile(path.resolve(dir, '.gitignore'), `${gitignore}\nout/`);</span>
      }
    }
  });
&nbsp;
  let babelConfig = <span class="cstat-no" title="statement not covered" >packageJSON.babel;</span>
  const babelPath = <span class="cstat-no" title="statement not covered" >path.resolve(dir, '.babelrc');</span>
<span class="cstat-no" title="statement not covered" >  if (!babelConfig &amp;&amp; await fs.exists(babelPath)) {</span>
<span class="cstat-no" title="statement not covered" >    babelConfig = JSON.parse(await fs.readFile(babelPath, 'utf8'));</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  if (babelConfig) {</span>
<span class="cstat-no" title="statement not covered" >    await asyncOra('Porting original babel config', <span class="fstat-no" title="function not covered" >as</span>ync () =&gt; {</span>
      let compileConfig = <span class="cstat-no" title="statement not covered" >{};</span>
      const compilePath = <span class="cstat-no" title="statement not covered" >path.resolve(dir, '.compilerc');</span>
<span class="cstat-no" title="statement not covered" >      if (await fs.exists(compilePath)) {</span>
<span class="cstat-no" title="statement not covered" >        compileConfig = JSON.parse(await fs.readFile(compilePath, 'utf8'));</span>
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      await fs.writeFile(compilePath, JSON.stringify(Object.assign(compileConfig, {</span>
        'application/javascript': babelConfig,
      }), null, 2));
    });
&nbsp;
<span class="cstat-no" title="statement not covered" >    console.info('NOTE: You might be able to remove your `.compilerc` file completely if you are only using the `es2015` and `react` presets'.yellow);</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  console.info(`</span>
&nbsp;
We have ATTEMPTED to convert your app to be in a format that electron-forge understands.
Nothing much will have changed but we added the ${'"electron-prebuilt-compile"'.cyan} dependency.  This is \
the dependency you must version bump to get newer versions of Electron.
&nbsp;
&nbsp;
We also tried to import any build tooling you already had but we can't get everything.  You might need to convert any CLI/gulp/grunt tasks yourself.
&nbsp;
Also please note if you are using \`preload\` scripts you need to follow the steps outlined \
at https://github.com/electron-userland/electron-forge/wiki/Using-%27preload%27-scripts
&nbsp;
Thanks for using ${'"electron-forge"'.green}!!!`);
};
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sun Jan 29 2017 17:21:02 GMT-0800 (PST)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
